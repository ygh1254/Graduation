<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>건설 작업자 이미지 생성기</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Diphylleia&family=Grandiflora+One&family=Moirai+One&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR:wght@400;700&family=Staatliches&family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <img src="chain.png" alt="chain" width="120">
  <h1>건설 작업자 이미지 생성기</h1>
  <h3>3D Blender 건설 작업자</h3>
  <br>

  <p style="background-color: lightyellow; color: black; font-size: 12pt;">
    무게(1-100g)를 선택하면 작업자가 돌을 드는 3D 이미지를 생성합니다.</p>
    <p>이미지 생성 방법은 다음과 같습니다.<br>
    <span style="text-decoration:underline;">1. 드롭다운에서 돌의 무게(1-100g)를 선택합니다.<br>
    2. Generate 버튼을 눌러 이미지를 생성합니다.<br>
    3. 생성된 이미지가 화면에 표시됩니다.<br>
    4. 이미지는 자동으로 저장됩니다.</span>
</p>

  <!-- 드롭다운과 버튼 -->
  <div style="display: flex; align-items: center;">
    <select id="weightSelect">
      <option value="" disabled selected>무게를 선택하세요</option>
    </select>
    <button onclick="generateImage()">Generate</button>
  </div>

  <!-- 결과 표시 영역 -->
  <div id="resultArea" style="display: none; margin-top: 20px;">
    <p style="font-weight: bold;">생성된 프롬프트:</p>
    <p id="promptText" style="font-size: 12px; background-color: #f0f0f0; padding: 10px; border: 1px dashed black;"></p>
    <p style="font-weight: bold; margin-top: 20px;">생성된 이미지:</p>
    <img id="generatedImage" style="max-width: 600px; border: 1px solid black;" />
  </div>

  <script>
    // 페이지 로드 시 드롭다운 옵션 생성
    window.addEventListener('DOMContentLoaded', () => {
      const select = document.getElementById('weightSelect');
      for (let i = 1; i <= 100; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${i}g`;
        select.appendChild(option);
      }
    });

    async function generateImage() {
      try {
        const select = document.getElementById('weightSelect');
        const selectedWeight = select.value;

        if (!selectedWeight) {
          alert('무게를 선택해주세요!');
          return;
        }

        console.log('🏗️ 이미지 생성 요청 시작 - 무게:', selectedWeight + 'g');

        // 버튼 비활성화 및 텍스트 변경
        const button = event.target;
        button.disabled = true;
        button.textContent = '생성 중...';

        const res = await fetch('http://localhost:3000/api/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ number: parseInt(selectedWeight) })
        });

        if (!res.ok) {
          throw new Error(`서버 오류: ${res.status} - ${res.statusText}`);
        }

        const result = await res.json();
        console.log('✅ 서버 응답:', result);

        if (result.success) {
          // 결과 표시
          document.getElementById('promptText').textContent = result.prompt;
          document.getElementById('generatedImage').src = result.imageUrl;
          document.getElementById('resultArea').style.display = 'block';

          alert('이미지 생성 완료!');
        } else {
          alert('이미지 생성 실패: ' + result.error);
        }

        // 버튼 활성화
        button.disabled = false;
        button.textContent = 'Generate';

      } catch (err) {
        console.error('이미지 생성 중 오류 발생:', err);
        alert('이미지 생성 중 오류 발생: ' + err.message);

        // 버튼 활성화
        event.target.disabled = false;
        event.target.textContent = 'Generate';
      }
    }
  </script>

</body>
</html>